{% extends 'main.html' %}

{% block title %}Dashboard | SloopStash CRM{% endblock %}

{% block content %}
<div class="row">
  <div class="col s3 m3 l3">
    <ul class="tab z-depth-1" id="main-menu">
      <li class="tab-item">
        <a class="tab-link" href="#customers">
          <span class="fa-stack purple-text text-purple">
            <i class="fa-regular fa-square fa-stack-2x"></i>
            <i class="fa-regular fa-address-book fa-stack-1x"></i>
          </span>
        </a>
        <p><small>Customers</small></p>
      </li>
    </ul>
  </div>
  <div class="col s18 m18 l18">
    <div class="block tab-content" id="customers">
      <div class="block-header clearfix valign-wrapper">
        <div class="block-title left">
          <h2>
            <span class="fa-stack purple-text text-purple fa-xs">
              <i class="fa-regular fa-square fa-stack-2x"></i>
              <i class="fa-regular fa-address-book fa-stack-1x"></i>
            </span> Customers
          </h2>
        </div>
        <div style="text-align: left; width: 80%; margin-left: 20px;">
     <h1>Welcome, {{ var.user.username }}!</h1>
   </div>
        <div class="block-menu right">
          <a class="btn-small green darken-1 right" href="/customer/create">Create customer</a>
        </div>
      </div>
      <div class="block-content"></div>
      <div class="block-footer">
        <div class="block-action right"></div>
      </div>
    </div>
  </div>
  <div class="col s3 m3 l3"></div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript">
  $(document).ready(function() {
    var main_menu = new app.tab({
      'container':'#main-menu',
      'default':'customers',
      'items':[
        {
          'identifier':'#customers',
          'pager':{
            'name':'customers',
            'mode':'normal',
            'entity':'customer',
            'url':'/customers',
            'query':null,
            'container':'#customers'
          }
        }
      ]
    });

    $(document).ready(function() {
    $(document).on('click', '.delete-customer', function() {
      var customerId = $(this).data('id');  

      
      if (confirm('Are you sure you want to delete this customer?')) {
       
        deleteCustomer(customerId);
      }
    });
});

function deleteCustomer(customerId) {
    $.ajax({
        type: "POST",
        url: "/customer/" + customerId + "/delete",
        data: {
            _method: 'DELETE'  
        },
        dataType: 'json',
        success: function(response) {
            if (response.status === "success") {
                alert(response.message);  
                if (response.refresh) {
                    location.reload();  
                } else {
                    $('#customer_' + customerId).remove();  
                }
            } else {
                alert(response.message);  
            }
        },
        error: function(xhr, status, error) {
            alert("An error occurred while deleting the customer.");
        }
    });
}

  });
</script>
{% endblock %}
